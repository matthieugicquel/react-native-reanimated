"use strict";(self.webpackChunkdocs_reanimated=self.webpackChunkdocs_reanimated||[]).push([[3271],{76446:(e,n,t)=>{t.d(n,{A:()=>c});var a=t(96540),r=t(9176),i=t(62257),o=t(78506),s=t(72188),l=t(55535);const d={code:"function RunOnJSTsx1(){const{runOnJS,setFinished}=this.__closure;runOnJS(setFinished)(true);}"},u={code:"function RunOnJSTsx2(){const{scale}=this.__closure;return{transform:[{scale:scale.value}]};}"};function c(){const e=(0,l.useSharedValue)(1),[n,t]=a.useState(!1),s=(0,l.useAnimatedStyle)(function(){const n=()=>({transform:[{scale:e.value}]});return n.__closure={scale:e},n.__workletHash=8738913883780,n.__initData=u,n}());return a.createElement(r.A,{style:m.container},a.createElement(l.default.View,{style:[m.box,s]}),a.createElement(i.A,{onPress:()=>{e.value=(0,l.withSpring)(2,{},function(){const e=function(){(0,l.runOnJS)(t)(!0)};return e.__closure={runOnJS:l.runOnJS,setFinished:t},e.__workletHash=7767882256352,e.__initData=d,e}())},title:"Click me",disabled:n}),n&&a.createElement(o.A,null,"Finished! \ud83c\udf89"))}const m=s.A.create({container:{flex:1,alignItems:"center"},box:{height:100,width:100,backgroundColor:"#b58df1",borderRadius:20,marginVertical:64,alignSelf:"center"}})},55826:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>b,frontMatter:()=>s,metadata:()=>d,toc:()=>c});var a=t(58168),r=(t(96540),t(15680)),i=t(76446),o=t(41121);const s={sidebar_position:1},l="runOnJS",d={unversionedId:"threading/runOnJS",id:"threading/runOnJS",title:"runOnJS",description:"runOnJS lets you asynchronously run non-workletized functions that couldn't otherwise run on the UI thread. This applies to most external libraries as they don't have their functions marked with \"worklet\"; directive.",source:"@site/docs/threading/runOnJS.mdx",sourceDirName:"threading",slug:"/threading/runOnJS",permalink:"/react-native-reanimated/docs/next/threading/runOnJS",draft:!1,editUrl:"https://github.com/software-mansion/react-native-reanimated/edit/main/packages/docs-reanimated/docs/threading/runOnJS.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Threading",permalink:"/react-native-reanimated/docs/next/category/threading"},next:{title:"runOnUI",permalink:"/react-native-reanimated/docs/next/threading/runOnUI"}},u={},c=[{value:"Reference",id:"reference",level:2},{value:"Arguments",id:"arguments",level:3},{value:"fn",id:"fn",level:4},{value:"Returns",id:"returns",level:3},{value:"Example",id:"example",level:2},{value:"Remarks",id:"remarks",level:2},{value:"Platform compatibility",id:"platform-compatibility",level:2}],m=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.yg)("div",n)},p=m("InteractiveExample"),h=m("Indent"),g=m("PlatformCompatibility"),y={toc:c},f="wrapper";function b(e){let{components:n,...t}=e;return(0,r.yg)(f,(0,a.A)({},y,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"runonjs"},"runOnJS"),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"runOnJS")," lets you asynchronously run non-",(0,r.yg)("a",{parentName:"p",href:"/docs/next/fundamentals/glossary#to-workletize"},"workletized")," functions that couldn't otherwise run on the ",(0,r.yg)("a",{parentName:"p",href:"/docs/next/fundamentals/glossary#ui-thread"},"UI thread"),". This applies to most external libraries as they don't have their functions marked with ",(0,r.yg)("inlineCode",{parentName:"p"},'"worklet";')," directive."),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"runOnJS")," is usually used to update React state either on animation finish or conditionally within a gesture."),(0,r.yg)("h2",{id:"reference"},"Reference"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"import { runOnJS } from 'react-native-reanimated';\n\nfunction App() {\n  // While on the UI thread\n  runOnJS(navigation.goBack)();\n}\n")),(0,r.yg)("details",null,(0,r.yg)("summary",null,"Type definitions"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"function runOnJS<A extends any[], R>(\n  fn: (...args: A) => R\n): (...args: Parameters<typeof fn>) => void;\n"))),(0,r.yg)("h3",{id:"arguments"},"Arguments"),(0,r.yg)("h4",{id:"fn"},"fn"),(0,r.yg)("p",null,"A reference to a function you want to execute on the ",(0,r.yg)("a",{parentName:"p",href:"/docs/next/fundamentals/glossary#javascript-thread"},"JavaScript thread")," from the ",(0,r.yg)("a",{parentName:"p",href:"/docs/next/fundamentals/glossary#ui-thread"},"UI thread"),". Arguments to your function have to be passed to the function returned from ",(0,r.yg)("inlineCode",{parentName:"p"},"runOnJS")," i.e. ",(0,r.yg)("inlineCode",{parentName:"p"},"runOnJS(setValue)(10);"),"."),(0,r.yg)("h3",{id:"returns"},"Returns"),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"runOnJS")," returns a function that accepts arguments for the function passed as the first argument. This function can be safely executed on the UI thread."),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},"Don't forget to call the function returned from ",(0,r.yg)("inlineCode",{parentName:"p"},"runOnJS"),".")),(0,r.yg)("h2",{id:"example"},"Example"),(0,r.yg)(p,{src:o.A,component:i.A,mdxType:"InteractiveExample"}),(0,r.yg)("h2",{id:"remarks"},"Remarks"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Functions passed to ",(0,r.yg)("inlineCode",{parentName:"li"},"runOnJS")," must be defined in the ",(0,r.yg)("a",{parentName:"li",href:"/docs/next/fundamentals/glossary#javascript-thread"},"JavaScript thread")," scope, i.e. in the component body or the global scope. This code won't work because ",(0,r.yg)("inlineCode",{parentName:"li"},"myFunction")," is defined in the ",(0,r.yg)("inlineCode",{parentName:"li"},"withTiming")," callback, which is only executed in the ",(0,r.yg)("a",{parentName:"li",href:"/docs/next/fundamentals/glossary#ui-thread"},"UI thread"),":")),(0,r.yg)(h,{mdxType:"Indent"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-jsx"},"withTiming(0, {}, () => {\n  // myFunction is defined on the UI thread \ud83d\udea8\n  const myFunction = () => {\n    // ...\n  };\n  runOnJS(myFunction)(); // \ud83d\udca5\n});\n"))),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"It's a common mistake to execute function inside of runOnJS like this: ",(0,r.yg)("del",{parentName:"p"},(0,r.yg)("inlineCode",{parentName:"del"},"runOnJS(setValue(10))()")),". Here, the correct usage would be ",(0,r.yg)("inlineCode",{parentName:"p"},"runOnJS(setValue)(10)"),".")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"It's safe to run functions via ",(0,r.yg)("inlineCode",{parentName:"p"},"runOnJS")," on the ",(0,r.yg)("a",{parentName:"p",href:"/docs/next/fundamentals/glossary#javascript-thread"},"JavaScript thread"),", as this has no effect."))),(0,r.yg)("h2",{id:"platform-compatibility"},"Platform compatibility"),(0,r.yg)(g,{android:!0,ios:!0,web:!0,mdxType:"PlatformCompatibility"}))}b.isMDXComponent=!0},41121:(e,n,t)=>{t.d(n,{A:()=>a});const a="import React from 'react';\nimport { Button, View, StyleSheet, Text } from 'react-native';\nimport Animated, {\n  useSharedValue,\n  withSpring,\n  runOnJS,\n} from 'react-native-reanimated';\nimport { useAnimatedStyle } from 'react-native-reanimated';\n\nexport default function App() {\n  const scale = useSharedValue<number>(1);\n  const [finished, setFinished] = React.useState<boolean>(false);\n\n  const handlePress = () => {\n    scale.value = withSpring(2, {}, () => {\n      // highlight-next-line\n      runOnJS(setFinished)(true);\n    });\n  };\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  return (\n    <View style={styles.container}>\n      <Animated.View style={[styles.box, animatedStyle]} />\n      <Button onPress={handlePress} title=\"Click me\" disabled={finished} />\n      {finished && <Text>Finished! \ud83c\udf89</Text>}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n  },\n  box: {\n    height: 100,\n    width: 100,\n    backgroundColor: '#b58df1',\n    borderRadius: 20,\n    marginVertical: 64,\n    alignSelf: 'center',\n  },\n});\n"},62257:(e,n,t)=>{t.d(n,{A:()=>d});var a=t(96540),r=t(72188),i=t(46413),o=t(78506),s=a.forwardRef(((e,n)=>{var t=e.accessibilityLabel,r=e.color,s=e.disabled,d=e.onPress,u=e.testID,c=e.title;return a.createElement(i.A,{accessibilityLabel:t,accessibilityRole:"button",disabled:s,focusable:!s,onPress:d,ref:n,style:[l.button,r&&{backgroundColor:r},s&&l.buttonDisabled],testID:u},a.createElement(o.A,{style:[l.text,s&&l.textDisabled]},c))}));s.displayName="Button";var l=r.A.create({button:{backgroundColor:"#2196F3",borderRadius:2},text:{color:"#fff",fontWeight:"500",padding:8,textAlign:"center",textTransform:"uppercase"},buttonDisabled:{backgroundColor:"#dfdfdf"},textDisabled:{color:"#a1a1a1"}});const d=s}}]);